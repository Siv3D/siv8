//-----------------------------------------------
//
//	This file is part of the Siv3D Engine.
//
//	Copyright (c) 2008-2024 Ryo Suzuki
//	Copyright (c) 2016-2024 OpenSiv3D Project
//
//	Licensed under the MIT License.
//
//-----------------------------------------------

# pragma once
# include "String.hpp"
# include "Unicode.hpp"
# include "Result.hpp"

namespace s3d
{
	class Blob;

	////////////////////////////////////////////////////////////////
	//
	//	Base64Value
	//
	////////////////////////////////////////////////////////////////

	class Base64Value
	{
	public:

		////////////////////////////////////////////////////////////////
		//
		//	(constructor)
		//
		////////////////////////////////////////////////////////////////

		[[nodiscard]]
		Base64Value() = default;

		[[nodiscard]]
		explicit constexpr Base64Value(const char8* base64);

		[[nodiscard]]
		explicit constexpr Base64Value(std::string_view base64);

		[[nodiscard]]
		explicit constexpr Base64Value(const std::string& base64);

		[[nodiscard]]
		explicit constexpr Base64Value(std::string&& base64);

		[[nodiscard]]
		explicit Base64Value(StringView base64);

		////////////////////////////////////////////////////////////////
		//
		//	encodeFromMemory
		//
		////////////////////////////////////////////////////////////////

		void encodeFromMemory(const void* src, size_t size);

		////////////////////////////////////////////////////////////////
		//
		//	encodeFromBlob
		//
		////////////////////////////////////////////////////////////////

		void encodeFromBlob(const Blob& blob);

		////////////////////////////////////////////////////////////////
		//
		//	encodeFromFile
		//
		////////////////////////////////////////////////////////////////

		void encodeFromFile(FilePathView path);

		////////////////////////////////////////////////////////////////
		//
		//	getBase64
		//
		////////////////////////////////////////////////////////////////

		[[nodiscard]]
		constexpr const std::string& getBase64() const noexcept;

		////////////////////////////////////////////////////////////////
		//
		//	isEmpty
		//
		////////////////////////////////////////////////////////////////

		[[nodiscard]]
		constexpr bool isEmpty() const noexcept;

		////////////////////////////////////////////////////////////////
		//
		//	operator bool
		//
		////////////////////////////////////////////////////////////////

		[[nodiscard]]
		constexpr explicit operator bool() const noexcept;

		////////////////////////////////////////////////////////////////
		//
		//	getBinarySize
		//
		////////////////////////////////////////////////////////////////

		[[nodiscard]]
		constexpr size_t getBinarySize() const noexcept;

		////////////////////////////////////////////////////////////////
		//
		//	decodeToMemory
		//
		////////////////////////////////////////////////////////////////

		Result<void, size_t> decodeToMemory(void* dst) const;

		////////////////////////////////////////////////////////////////
		//
		//	decodeToBlob
		//
		////////////////////////////////////////////////////////////////

		Result<void, size_t> decodeToBlob(Blob& dst) const;

		[[nodiscard]]
		Blob decodeToBlob() const;

		////////////////////////////////////////////////////////////////
		//
		//	decodeToFile
		//
		////////////////////////////////////////////////////////////////

		/// @brief Base64 値をデコードした結果をファイルに保存します。
		/// @param path 保存先のファイルパス
		/// @return 保存に成功した場合 true, それ以外の場合は false
		bool decodeToFile(FilePathView path) const;

		////////////////////////////////////////////////////////////////
		//
		//	EncodeFromMemoery
		//
		////////////////////////////////////////////////////////////////

		/// @brief メモリ上のデータから Base64 値を作成します。
		/// @param src データの先頭ポインタ
		/// @param size データのサイズ（バイト）
		/// @return 作成された Base64 値
		[[nodiscard]]
		static Base64Value EncodeFromMemoery(const void* src, size_t size);

		////////////////////////////////////////////////////////////////
		//
		//	EncodeFromBlob
		//
		////////////////////////////////////////////////////////////////

		/// @brief Blob から Base64 値を作成します。
		/// @param blob Blob
		/// @return 作成された Base64 値
		[[nodiscard]]
		static Base64Value EncodeFromBlob(const Blob& blob);

		////////////////////////////////////////////////////////////////
		//
		//	EncodeFromFile
		//
		////////////////////////////////////////////////////////////////

		/// @brief ファイルの内容から Base64 値を作成します。
		/// @param path ファイルパス
		/// @return 作成された Base64 値
		[[nodiscard]]
		static Base64Value EncodeFromFile(FilePathView path);

	private:

		std::string m_base64;
	};
}

# include "detail/Base64Value.ipp"
