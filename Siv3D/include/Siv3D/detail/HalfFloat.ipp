//-----------------------------------------------
//
//	This file is part of the Siv3D Engine.
//
//	Copyright (c) 2008-2024 Ryo Suzuki
//	Copyright (c) 2016-2024 OpenSiv3D Project
//
//	Licensed under the MIT License.
//
//-----------------------------------------------

# pragma once

namespace s3d
{
	////////////////////////////////////////////////////////////////
	//
	//	(constructor)
	//
	////////////////////////////////////////////////////////////////

	inline HalfFloat::HalfFloat(const float value) noexcept
		: m_bits{ DirectX::PackedVector::XMConvertFloatToHalf(value) } {}

	HalfFloat::HalfFloat(const Concept::Arithmetic auto value) noexcept
		: HalfFloat{ static_cast<float>(value) } {}

	////////////////////////////////////////////////////////////////
	//
	//	operator =
	//
	////////////////////////////////////////////////////////////////

	inline HalfFloat& HalfFloat::operator =(const float value) noexcept
	{
		m_bits = DirectX::PackedVector::XMConvertFloatToHalf(value);
		return *this;
	}

	HalfFloat& HalfFloat::operator =(const Concept::Arithmetic auto value)
	{
		return operator =(static_cast<float>(value));
	}

	////////////////////////////////////////////////////////////////
	//
	//	operator +
	//
	////////////////////////////////////////////////////////////////

	constexpr HalfFloat HalfFloat::operator +() const noexcept
	{
		return *this;
	}

	////////////////////////////////////////////////////////////////
	//
	//	operator -
	//
	////////////////////////////////////////////////////////////////

	constexpr HalfFloat HalfFloat::operator -() const noexcept
	{
		HalfFloat result;
		result.m_bits = (m_bits ^ SignMask);
		return result;
	}

	////////////////////////////////////////////////////////////////
	//
	//	asFloat
	//
	////////////////////////////////////////////////////////////////

	inline float HalfFloat::asFloat() const noexcept
	{
		return DirectX::PackedVector::XMConvertHalfToFloat(m_bits);
	}

	////////////////////////////////////////////////////////////////
	//
	//	operator float
	//
	////////////////////////////////////////////////////////////////

	inline HalfFloat::operator float() const noexcept
	{
		return asFloat();
	}

	////////////////////////////////////////////////////////////////
	//
	//	getBits
	//
	////////////////////////////////////////////////////////////////

	constexpr uint16 HalfFloat::getBits() const noexcept
	{
		return m_bits;
	}

	////////////////////////////////////////////////////////////////
	//
	//	setBits
	//
	////////////////////////////////////////////////////////////////

	constexpr void HalfFloat::setBits(const uint16 bits) noexcept
	{
		m_bits = bits;
	}

	////////////////////////////////////////////////////////////////
	//
	//	isZero
	//
	////////////////////////////////////////////////////////////////

	constexpr bool HalfFloat::isZero() const noexcept
	{
		return IsZero(m_bits);
	}

	////////////////////////////////////////////////////////////////
	//
	//	isNaN
	//
	////////////////////////////////////////////////////////////////

	constexpr bool HalfFloat::isNaN() const noexcept
	{
		return IsNaN(m_bits);
	}

	////////////////////////////////////////////////////////////////
	//
	//	isInfinity
	//
	////////////////////////////////////////////////////////////////

	constexpr bool HalfFloat::isInfinity() const noexcept
	{
		return ((m_bits & 0x7FFF) == 0x7C00);
	}

	////////////////////////////////////////////////////////////////
	//
	//	signBit
	//
	////////////////////////////////////////////////////////////////

	constexpr bool HalfFloat::signBit() const noexcept
	{
		return static_cast<bool>(m_bits & SignMask);
	}

	////////////////////////////////////////////////////////////////
	//
	//	abs
	//
	////////////////////////////////////////////////////////////////

	constexpr HalfFloat HalfFloat::abs() const noexcept
	{
		HalfFloat result;
		result.m_bits = (m_bits & 0x7FFF);
		return result;
	}

	////////////////////////////////////////////////////////////////
	//
	//	hash
	//
	////////////////////////////////////////////////////////////////

	inline uint64 HalfFloat::hash() const noexcept
	{
		return Hash(m_bits);
	}

	////////////////////////////////////////////////////////////////
	//
	//	IsZero
	//
	////////////////////////////////////////////////////////////////

	constexpr bool HalfFloat::IsZero(const uint16 bits) noexcept
	{
		return ((bits & 0x7FFF) == 0);
	}

	////////////////////////////////////////////////////////////////
	//
	//	IsNaN
	//
	////////////////////////////////////////////////////////////////

	constexpr bool HalfFloat::IsNaN(const uint16 bits) noexcept
	{
		return (0x7C00 < (bits & 0x7FFF));
	}
}
